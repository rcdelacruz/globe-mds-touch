(function(a){var b={init:function(c){var d=a.extend({height:50,instruction:"Pull down to refresh...",message:"Release to refresh...",confirmation:"Refreshing..."},c);var e=this,f=0,g=2,h=0,i=d.height,j=0,k=0;this.before('<div id="pull-to-refresh"><span>'+d.instruction+"</span></div>");b.$controlEl=a("#pull-to-refresh");var l=i/2-b.$controlEl.find("span").height()/2;b.marginAdjustment=parseInt(b.$controlEl.css("marginTop"));i-=b.marginAdjustment;b.$controlEl.css({height:i,marginTop:-i});b.$controlEl.find("span").css({display:"block",paddingTop:l});b.marginTop=parseInt(b.$controlEl.css("marginTop"));b.marginTopAbs=Math.abs(b.marginTop);this.bind("touchstart.ptr",function(b){if(b.originalEvent.targetTouches.length==1)f=b.originalEvent.targetTouches[0].pageY;j=e.offset().top;k=a(window).scrollTop()});this.bind("touchend.ptr",function(){if(h>b.marginTopAbs+b.marginAdjustment){var a=b.marginAdjustment;b.$controlEl.animate({marginTop:a,paddingTop:0},250).find("span").text(d.confirmation);d.callback()}else{b.$controlEl.animate({marginTop:b.marginTop,paddingTop:0},250)}h=0});this.bind("touchmove.ptr",function(a){var a=a.originalEvent;if(a.targetTouches.length==1){var c=a.targetTouches[0].pageY;if(j>=k){if(c>f){h=Math.round((c-f)/g);if(h<b.marginTopAbs&&b.marginTop+h<b.marginAdjustment){b.$controlEl.css("marginTop",b.marginTop+h).find("span").text(d.instruction)}else{var e=b.marginAdjustment;b.$controlEl.css({marginTop:e,paddingTop:h-b.marginTopAbs+Math.abs(e)}).find("span").text(d.message)}return false}}}})},hide:function(){b.$controlEl.animate({marginTop:b.marginTop},250)}};a.fn.pullToRefresh=function(c){if(b[c]){return b[c].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof c==="object"||!c){return b.init.apply(this,arguments)}else{a.error("Method "+c+" does not exist.")}}})(jQuery)
